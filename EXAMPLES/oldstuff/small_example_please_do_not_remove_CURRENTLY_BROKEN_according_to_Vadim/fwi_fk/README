

---------------- COMPILATION ------------------------------  

  1 -- compile specfem 

         run configure file ex:

          ./configure FC=ifort MPIFC=mpif90 CC=icc



   with option :
   you need to add this folowing line in Makefile in specfem3d_Git_devel directory 

            DEBUG_COUPLED_FLAG=-DDEBUG_COUPLED -DUSE_VTK_INSTEAD_OF_MESH

      type 

            make all 


    2 -- compile DSM_FOR_SPECFEM3D/inverse_problem

      edit Makefile and fill the variables 
         FC=
         MPIFC=
         FLAGS_CHECK=

    with the same values that are in Makefile generated by specfem previously


--------------- running Full Waveform Inversion exemple --------------------- 


           ********* CONVENTIONS ************

  *** note that for FK model the coordinate z=0 is situated at the bottom of layered model. 
      thus the for the station z coordinate you must put the rigth coordinate for FK. 
      ie z = 0 will put the station at the bottom of layered model 
         z = heigth of layered model will put the station at the free surface

      -- the elevetion of this free surface is defined by the file   DATA/meshfem3D_files/interfaces.dat
         and it should be coherent with the FKmodel : (eg :  DATA/DATA_SYNTHS/1/FKmodel_0_20 )
     
         in the file DATA/meshfem3D_files/Mesh_Par_file, the variable DEPTH_BLOCK_KM is the 
         depth of the model below z=0 


   to run the example : 
 
      1. create the mesh with initial model :
            create_mesh.sh
   
       2. run the inverions :
            run_inversion.sh
  
-------------------- INPUTS FILES FOR FWI INVERSION -----------------



  1/ the FWI code is based on specfem package that means all files needed to run specfem are
     require for the FWI:

       DATA/Par_file DATA/STATIONS OUTPUTS_FILES/ DATABASE_MPI/


  2/ additionally 2 more files are specific to FWI

      DATA/inverse_problem/inversion_fwi_par
      DATA/inverse_problem/acqui_file.txt

  3/ the wave form data are in the directory

      DATA/DATA_SYNTHS/*/Gather.bin

     that is a binary file contains Ux, Uy, Uz component for each station sampled at specfem time step

